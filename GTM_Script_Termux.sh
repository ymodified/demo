#!/bin/bash

clear

function endscript() {
  exit 1
}

trap endscript 2 15

echo -n "Enter DNS IPs separated by ' ': "
read -a DNS_IPS

echo -n "Enter Your NameServers separated by ' ': "
read -a NAME_SERVERS

LOOP_DELAY=5

DIG_EXEC="DEFAULT"

CUSTOM_DIG=/data/data/com.termux/files/home/go/bin/fastdig

VER=0.3

case "${DIG_EXEC}" in
 DEFAULT|D)
 _DIG="$(command -v dig)"
 ;;
 CUSTOM|C)
 _DIG="${CUSTOM_DIG}"
 ;;
esac

if [ ! $(command -v ${_DIG}) ]; then
 printf "%b" "Dig command failed to run, " \
 "please install dig(dnsutils) or check " \
 "\$DIG_EXEC & \$CUSTOM_DIG variable inside $( cd -- "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )/$(basename "$0") file.\n" && exit 1
fi

check(){
  for T in "${DNS_IPS[@]}"; do
    for R in "${NAME_SERVERS[@]}"; do
      result=$(${_DIG} @${T} ${R})
      if [ -z "$result" ]; then
        M=31
        STATUS="\e[1;31mFailed\e[0m"
      else
        M=32
        STATUS="\e[1;32mSuccess\e[0m"
      fi
      echo -e "\e[1;${M}m\$ R:${R} D:${T} - Status: $STATUS\e[0m"
    done
  done
}

echo "

────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
─████████──████████─██████──────────██████─██████████████─████████████───██████████─██████████████─██████████─██████████████─████████████───
─██░░░░██──██░░░░██─██░░██████████████░░██─██░░░░░░░░░░██─██░░░░░░░░████─██░░░░░░██─██░░░░░░░░░░██─██░░░░░░██─██░░░░░░░░░░██─██░░░░░░░░████─
─████░░██──██░░████─██░░░░░░░░░░░░░░░░░░██─██░░██████░░██─██░░████░░░░██─████░░████─██░░██████████─████░░████─██░░██████████─██░░████░░░░██─
───██░░░░██░░░░██───██░░██████░░██████░░██─██░░██──██░░██─██░░██──██░░██───██░░██───██░░██───────────██░░██───██░░██─────────██░░██──██░░██─
───████░░░░░░████───██░░██──██░░██──██░░██─██░░██──██░░██─██░░██──██░░██───██░░██───██░░██████████───██░░██───██░░██████████─██░░██──██░░██─
─────████░░████─────██░░██──██░░██──██░░██─██░░██──██░░██─██░░██──██░░██───██░░██───██░░░░░░░░░░██───██░░██───██░░░░░░░░░░██─██░░██──██░░██─
───────██░░██───────██░░██──██████──██░░██─██░░██──██░░██─██░░██──██░░██───██░░██───██░░██████████───██░░██───██░░██████████─██░░██──██░░██─
───────██░░██───────██░░██──────────██░░██─██░░██──██░░██─██░░██──██░░██───██░░██───██░░██───────────██░░██───██░░██─────────██░░██──██░░██─
───────██░░██───────██░░██──────────██░░██─██░░██████░░██─██░░████░░░░██─████░░████─██░░██─────────████░░████─██░░██████████─██░░████░░░░██─
───────██░░██───────██░░██──────────██░░██─██░░░░░░░░░░██─██░░░░░░░░████─██░░░░░░██─██░░██─────────██░░░░░░██─██░░░░░░░░░░██─██░░░░░░░░████─
───────██████───────██████──────────██████─██████████████─████████████───██████████─██████─────────██████████─██████████████─████████████───
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────"
echo -e "DNS IPs: \e[1;34m${DNS_IPS[*]}\e[0m"
echo -e "NameServers: \e[1;34m${NAME_SERVERS[*]}\e[0m"

while true; do
  check
  sleep $LOOP_DELAY
done

exit 0
